!function(F,t){"use strict";var x="ht",E=x+".layout.",D=F[x]||module.parent.exports.ht,p=D.List,O=D.DataModel,J=D.Node,c=D.Edge,z=D.Group,w=Math,r=w.sqrt,n=w.random,d=w.max,i=w.min,U=function(A){return A*A};D.Default.getInternal().addMSMap({ms_force:function(f){f._interval=50,f._stepCount=10,f._motionLimit=.01,f._edgeRepulsion=.65,f._nodeRepulsion=.65,f._damper=1,f._maxMotion=0,f._motionRatio=0,f.init=function(Z){var l=this;Z instanceof O?l.dm=Z:l.gv=Z,l._nodeMap={},l._nodes=new p,l._edges=new p},f.start=function(){var N=this,q=N.gv;if(!N._timer){var C=N.cdm=q?q.dm():N.dm;C.mm(N.handleDataModelChange,N),C.md(N.handleDataPropertyChange,N),q&&q.mp(N.handleGV,N),C.each(function(I){if(N.isVisible(I)&&N.isLayoutable(I)&&I instanceof J)if(N instanceof Q){var O=I.p3();I.p3([O[0]+n(),O[1]+n(),O[2]+n()])}else O=I.p(),I.p(O.x+n(),O.y+n())}),N._timer=setInterval(function(){N.relax()},N._interval),N._damper=1}},f.stop=function(){var V=this;V._timer&&(V.cdm.umm(V.handleDataModelChange,V),V.cdm.umd(V.handleDataPropertyChange,V),V.gv&&V.gv.ump(V.handleGV,V),clearInterval(V._timer),delete V._timer,delete V.cdm)},f.handleGV=function(W){var f=this;if("dataModel"===W.property){var j=W.oldValue,o=W.newValue;j&&(j.umm(f.handleDataModelChange,f),j.umd(f.handleDataPropertyChange,f)),this.cdm=o,o.mm(f.handleDataModelChange,f),o.md(f.handleDataPropertyChange,f)}},f.relax=function(){var H=this;if(!(H._damper<.1&&H._maxMotion<H._motionLimit)){this.cdm.each(function(_){H.isVisible(_)&&(_ instanceof c?H.addEdge(_):_ instanceof J&&H.addNode(_))});for(var N,I,O=0,K=H._edges,C=H._nodes,i=C.size();O<H._stepCount;O++){for(K.each(H.relaxEdge,H),N=0;i>N;N++)for(I=0;i>I;I++)H.relaxNode(C.get(N),C.get(I));H.moveNode()}H._isAdjusting=1,C.each(function(f){f.fix||(f.p?f.v.p3(f.p):f.v.p(f.x,f.y))}),delete H._isAdjusting,H._nodeMap={},C.clear(),K.clear(),H.onRelaxed()}},f.onRelaxed=function(){},f.isRunning=function(){return!!this._timer},f.isVisible=function(L){return L.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(L):!0},f.isLayoutable=function(L){if(L.s("layoutable")===!1)return!1;if(L instanceof z)return!1;var U=this;return U.gv?U.gv.isMovable(L)&&!U.gv.isSelected(L):!(U.cdm||U.dm).sm().co(L)},f.getNodeRepulsion=function(){return this._nodeRepulsion},f.setNodeRepulsion=function(L){this._nodeRepulsion=L,this._damper=1},f.getEdgeRepulsion=function(){return this._edgeRepulsion},f.setEdgeRepulsion=function($){this._edgeRepulsion=$,this._damper=1},f.getStepCount=function(){return this._stepCount},f.setStepCount=function(n){this._stepCount=n,this._damper=1},f.getInterval=function(){return this._interval},f.setInterval=function(N){var t=this;t._interval!==N&&(t._interval=N,t._timer&&(clearInterval(t._timer),t._timer=setInterval(function(){t.relax()},N)))},f.handleDataPropertyChange=function(n){!this._isAdjusting&&this.isVisible(n.data)&&(this._damper=1)},f.handleDataModelChange=function(){this._damper=1},f.damp=function(){var r=this._maxMotion,Q=this._damper;this._motionRatio<=.001&&((.2>r||r>1&&.9>Q)&&Q>.01?this._damper-=.01:.4>r&&Q>.003?this._damper-=.003:Q>1e-4&&(this._damper-=1e-4)),r<this._motionLimit&&(this._damper=0)}}}),D.layout.ForceLayout=function(J){this.init(J)},D.Default.def(E+"ForceLayout",t,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(r){this._limitBounds=r,this._damper=1},getNodeSize:function(a){var E=this.gv;return E&&E.getDataUIBounds?E.getDataUIBounds(a):a.getRect()},addNode:function(v){var y=this,E=y._nodeMap[v._id];if(E)return E;var e=v.p();E={v:v,x:e.x,y:e.y,dx:0,dy:0,fix:!y.isLayoutable(v),s:y.getNodeSize(v)};var C=E.s,I=r(U(C.width)+U(C.height))*y._nodeRepulsion;return E.r=1>I?100:I,y._nodeMap[v._id]=E,y._nodes.add(E),E},addEdge:function(b){if(b._40I&&b._41I){var g=this,s=g.addNode(b._40I),u=g.addNode(b._41I),E={s:s,t:u};u=u.s,s=s.s;var J=u.width+s.width,N=u.height+s.height;E.length=r(J*J+N*N)*g._edgeRepulsion,E.length<=0&&(E.length=100),g._edges.add(E)}},relaxEdge:function(h){var x=h.t,$=h.s,e=x.x-$.x,z=x.y-$.y,G=r(e*e+z*z),f=100*h.length,D=.25*e/f*G,K=.25*z/f*G;x.dx=x.dx-D,x.dy=x.dy-K,$.dx=$.dx+D,$.dy=$.dy+K},relaxNode:function(o,B){if(o!==B){var L=0,b=0,T=o.x-B.x,V=o.y-B.y,x=T*T+V*V;0===x?(L=n(),b=n()):36e4>x&&(L=T/x,b=V/x);var N=o.r*B.r/400;L*=N,b*=N,o.dx+=L,o.dy+=b,B.dx-=L,B.dy-=b}},moveNode:function(){var y=this,E=y._limitBounds,C=y._maxMotion,K=0,S=y._damper;y._nodes.each(function(N){if(!N.fix){var F=N.dx*S,B=N.dy*S;if(N.dx=F/2,N.dy=B/2,K=d(r(F*F+B*B),K),N.x+=d(-40,i(40,F)),N.y+=d(-40,i(40,B)),E){N.x<E.x&&(N.x=E.x,y.adjust(1,0)),N.y<E.y&&(N.y=E.y,y.adjust(0,1));var p=N.s;N.x+p.width>E.x+E.width&&(N.x=E.x+E.width-p.width,y.adjust(-1,0)),N.y+p.height>E.y+E.height&&(N.y=E.y+E.height-p.height,y.adjust(0,-1))}}}),y._maxMotion=K,y._motionRatio=K>0?C/K-1:0,y.damp()},adjust:function(N,I){var J=this._limitBounds;this._nodes.each(function(b){N>0?(!J||b.x+b.s.width+N<J.x+J.width)&&(b.x+=N):(!J||b.x+N>J.x)&&(b.x+=N),I>0?(!J||b.y+b.s.height+I<J.y+J.height)&&(b.y+=I):(!J||b.y+I>J.y)&&(b.y+=I)})}});var Q=D.layout.Force3dLayout=function(w){this.init(w)};D.Default.def(E+"Force3dLayout",t,{ms_force:1,getNodeSize3d:function(B){return B.s3()},addNode:function(U){var Z=this,t=Z._nodeMap[U._id];if(t)return t;t={v:U,p:U.p3(),d:[0,0,0],fix:!Z.isLayoutable(U),s:Z.getNodeSize3d(U)};var i=t.s,F=D.Default.getDistance(i)*Z._nodeRepulsion;return t.r=1>F?100:F,Z._nodeMap[U._id]=t,Z._nodes.add(t),t},addEdge:function(H){if(H._40I&&H._41I){var E=this,e=E.addNode(H._40I),k=E.addNode(H._41I),f={s:e,t:k};k=k.s,e=e.s,f.length=r(U(k[0]+e[0])+U(k[1]+e[1])+U(k[2]+e[2]))*E._edgeRepulsion,f.length<=0&&(f.length=100),E._edges.add(f)}},relaxEdge:function(M){var e=M.t.p,k=M.s.p,F=M.t.d,G=M.s.d,T=e[0]-k[0],I=e[1]-k[1],B=e[2]-k[2],j=r(T*T+I*I+B*B),t=100*M.length,x=.25*T/t*j,n=.25*I/t*j,R=.25*B/t*j;F[0]-=x,F[1]-=n,F[2]-=R,G[0]+=x,G[1]+=n,G[2]+=R},relaxNode:function(L,j){if(L!==j){var Q=L.p,a=j.p,r=0,F=0,B=0,k=Q[0]-a[0],z=Q[1]-a[1],d=Q[2]-a[2],C=k*k+z*z+d*d;0===C?(r=n(),F=n(),B=n()):216e6>C&&(r=k/C,F=z/C,B=d/C);var P=L.r*j.r/400,m=L.d,E=j.d;r*=P,F*=P,B*=P,m[0]+=r,m[1]+=F,m[2]+=B,E[0]-=r,E[1]-=F,E[2]-=B}},moveNode:function(){var v=this,y=v._maxMotion,j=0,n=v._damper;v._nodes.each(function(I){if(!I.fix){var C=I.p,R=I.d,k=R[0]*n,s=R[1]*n,p=R[2]*n;R[0]=k/2,R[1]=s/2,R[2]=p/2,j=d(r(k*k+s*s+p*p),j),C[0]+=d(-40,i(40,k)),C[1]+=d(-40,i(40,s)),C[2]+=d(-40,i(40,p))}}),v._maxMotion=j,v._motionRatio=j>0?y/j-1:0,v.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);