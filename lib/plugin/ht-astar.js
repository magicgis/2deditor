!function(T,z,w){"use strict";var j=T.ht;j.Astar={},function(m){var y=m();T.AStar=y.astar,T.AStar.Graph=y.Graph}(function(){function c(q){for(var W=q,l=[];W.parent;)l.unshift(W),W=W.parent;return l}function d(){return new J(function(C){return C.f})}function e(J,s){s=s||{},this.nodes=[],this.diagonal=!!s.diagonal,this.grid=[];for(var z=0;z<J.length;z++){this.grid[z]=[];for(var V=0,k=J[z];V<k.length;V++){var t=new K(z,V,k[V]);this.grid[z][V]=t,this.nodes.push(t)}}this.$13x()}function K(U,f,q){this.x=U,this.y=f,this.weight=q}function J(C){this.content=[],this.scoreFunction=C}var z={search:function(i,f,v,O){i.$6x(),O=O||{};var G=O.heuristic;G||(G=i.diagonal?z.$4x.diagonal:z.$4x.manhattan);var P=O.closest||!1,b=O.punish,k=d(),u=f;for(f.h=G(f,v),i.$7x(f),k.push(f);k.size()>0;){var r=k.pop();if(r===v)return c(r);r.closed=!0;for(var R=i.neighbors(r),e=0,T=R.length;T>e;++e){var V=R[e];if(!V.closed&&!V.$9x()){var J=r.g+V.getCost(r,b),j=V.visited;(!j||J<V.g)&&(V.visited=!0,V.parent=r,V.h=V.h||G(V,v),V.g=J,V.f=V.g+V.h,i.$7x(V),P&&(V.h<u.h||V.h===u.h&&V.g<u.g)&&(u=V),j?k.$10x(V):k.push(V))}}}return P?c(u):[]},$4x:{manhattan:function($,Q){var t=Math.abs(Q.x-$.x),T=Math.abs(Q.y-$.y);return t+T},diagonal:function(D,h){var n=1,U=Math.sqrt(2),l=Math.abs(h.x-D.x),P=Math.abs(h.y-D.y);return n*(l+P)+(U-2*n)*Math.min(l,P)}},$5x:function(z){z.f=0,z.g=0,z.h=0,z.visited=!1,z.closed=!1,z.parent=null}};return e.prototype.$13x=function(){this.dirtyNodes=[];for(var o=0;o<this.nodes.length;o++)z.$5x(this.nodes[o])},e.prototype.$6x=function(){for(var K=0;K<this.dirtyNodes.length;K++)z.$5x(this.dirtyNodes[K]);this.dirtyNodes=[]},e.prototype.$7x=function(C){this.dirtyNodes.push(C)},e.prototype.neighbors=function(O){var A=[],e=O.x,d=O.y,E=this.grid;return E[e-1]&&E[e-1][d]&&A.push(E[e-1][d]),E[e+1]&&E[e+1][d]&&A.push(E[e+1][d]),E[e]&&E[e][d-1]&&A.push(E[e][d-1]),E[e]&&E[e][d+1]&&A.push(E[e][d+1]),this.diagonal&&(E[e-1]&&E[e-1][d-1]&&A.push(E[e-1][d-1]),E[e+1]&&E[e+1][d-1]&&A.push(E[e+1][d-1]),E[e-1]&&E[e-1][d+1]&&A.push(E[e-1][d+1]),E[e+1]&&E[e+1][d+1]&&A.push(E[e+1][d+1])),A},e.prototype.toString=function(){for(var P=[],N=this.grid,j=0;j<N.length;j++){for(var f=[],T=N[j],s=0;s<T.length;s++)f.push(T[s].weight);P.push(f.join(" "))}return P.join("\n")},K.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},K.prototype.getCost=function(x,l){var B;if(B=x&&x.x!=this.x&&x.y!=this.y?1.41421*this.weight:this.weight,l){var f=x;if(!f)return B;var o=f.parent;return o?Math.abs(o.x+this.x-2*f.x)>1e-5?B+l:Math.abs(o.y+this.y-2*f.y)>1e-5?B+l:B:B}},K.prototype.$9x=function(){return 0===this.weight},J.prototype={push:function(u){this.content.push(u),this.$11x(this.content.length-1)},pop:function(){var t=this.content[0],a=this.content.pop();return this.content.length>0&&(this.content[0]=a,this.$12x(0)),t},remove:function(G){var e=this.content.indexOf(G),v=this.content.pop();e!==this.content.length-1&&(this.content[e]=v,this.scoreFunction(v)<this.scoreFunction(G)?this.$11x(e):this.$12x(e))},size:function(){return this.content.length},$10x:function(I){this.$11x(this.content.indexOf(I))},$11x:function(I){for(var $=this.content[I];I>0;){var V=(I+1>>1)-1,r=this.content[V];if(!(this.scoreFunction($)<this.scoreFunction(r)))break;this.content[V]=$,this.content[I]=r,I=V}},$12x:function(k){for(var b=this.content.length,E=this.content[k],s=this.scoreFunction(E);;){var L,n=k+1<<1,T=n-1,g=null;if(b>T){var p=this.content[T];L=this.scoreFunction(p),s>L&&(g=T)}if(b>n){var q=this.content[n],G=this.scoreFunction(q);(null===g?s:L)>G&&(g=n)}if(null===g)break;this.content[k]=this.content[g],this.content[g]=E,k=g}}},{astar:z,Graph:e}});var Z=j.Astar.Finder=function(V,G){var Q=this;Q.gv=V,Q.$13x(G),Q.refreshMap()};Z.prototype={},Z.prototype.constructor=Z,z.defineProperties(Z.prototype,{_debugInfo:{get:function(){return this.gv._astarDebugInfo},set:function(Z){this.gv._astarDebugInfo=Z}}}),Z.prototype.$13x=function(B){var K=this,M=K.$14x={};B=B||{};var l=B.gridSize||10;M.gridSizeX=B.gridSizeX||l,M.gridSizeY=B.gridSizeY||l,M.rect=B.rect,M.filter=B.filter,M.extendBlocks=B.extendBlocks||3,M.fastOverlap=B.fastOverlap===w?!0:B.fastOverlap,M.nodeRectExtend=B.nodeRectExtend||0,M.diagonal=B.diagonal===w?!0:B.diagonal,M.turnPunish=B.turnPunish===w?.1:B.turnPunish,M.simplify=B.simplify===w?!0:B.simplify,M.toGridCenter=B.toGridCenter===w?!1:B.toGridCenter,M.closest=B.closest===w?!0:B.closest},Z.prototype.refreshMap=function(){var k,C=this,N=C.$14x,t=N.gridSizeX,Q=N.gridSizeY,A=N.extendBlocks;N.rect?k=N.rect:(k=C.$15x(),j.Default.grow(k,t*A,Q*A)),j.Default.grow(k,t,Q);var J=Math.floor(k.x/t)*t,F=Math.floor(k.y/Q)*Q,H=Math.ceil(k.width/t),Y=Math.ceil(k.height/Q),T=H*t,h=Y*Q;C.$16x={x:J,y:F,w:T,h:h,gridX:t,gridY:Q,xLen:H,yLen:Y},C.$17x(),C.$21x()},Z.prototype.$15x=function(){var g=this.gv;if(g instanceof j.graph.GraphView)return g.getContentRect();var A,V=j.Default.unionRect;return g.dm().each(function(L){g.isVisible(L)&&L.getRect&&(A=V(A,L.getRect()))}),A},Z.prototype.$17x=function(){var S,V,U,P,c=this,L=c.$16x,O=L.xLen,R=L.yLen;for(S=new Array(O),U=0;O>U;U++)for(S[U]=V=new Array(R),P=R;P--;)V[P]=1;var Z=c.$14x.filter;for(c.gv.dm().each(function(P){Z&&Z(P)===!1||(!c._debugInfo||P!==c._debugInfo.grid&&P!=c._debugInfo.path)&&c.$1cw(S,P)}),U=0;O>U;U++)S[U][0]=1,S[U][R-1]=1;for(P=0;R>P;P++)S[0][P]=1,S[O-1][P]=1;c.grid=S;var t=new AStar.Graph(S,{diagonal:c.$14x.diagonal});c.graph=t},Z.prototype.$18x=function(u,l,g,L,H,Y,E,K){var m=this.$19x,G=m(g-u,H-E,L-l,Y-K);if(1e-6>=G&&G>=-1e-6)return!1;var R=m(H-u,H-E,Y-l,Y-K)/G;if(0>R||R>1)return!1;var W=m(g-u,H-u,L-l,Y-l)/G;return 0>W||W>1?!1:!0},Z.prototype.$19x=function(m,t,W,f){return m*f-t*W},Z.prototype.$1aw=function(I,z,x,c){for(var M=[-(z[1]-I[1]),z[0]-I[0]],t=M[0]*(x[0]-I[0])+M[1]*(x[1]-I[1])>=0,l=0,V=c.length;V>l;l+=2)if(M[0]*(c[l]-I[0])+M[1]*(c[l+1]-I[1])>=0===t)return!1;return!0},Z.prototype.$1bw=function(C,A){for(var X,K,H=this,h=0,S=C.length;S>h;h+=2)if(X=h===S-2?0:h+2,K=X===S-2?0:X+2,H.$1aw([C[h],C[h+1]],[C[X],C[X+1]],[C[K],C[K+1]],A))return!1;for(var h=0,S=A.length;S>h;h+=2)if(X=h===S-2?0:h+2,K=X===S-2?0:X+2,H.$1aw([A[h],A[h+1]],[A[X],A[X+1]],[A[K],A[K+1]],C))return!1;return!0},Z.prototype.$1cw=function(m,c){if(c.getRect){var V=this,p=c.getRect();j.Default.grow(p,V.$14x.nodeRectExtend);var F,b,K,e,y,z,n,E,I,A,D,Y=V.$1dw({x:p.x,y:p.y}),q=V.$1dw({x:p.x+p.width,y:p.y+p.height}),v=V.$14x.fastOverlap;if(!v){var r=c.getCorners();n=[],r.forEach(function(c){n.push(c.x,c.y)}),A=V.$14x.gridSizeX/2,D=V.$14x.gridSizeY/2}for(b=Math.max(0,Y.x),K=Math.min(q.x,m.length-1),y=Math.max(0,Y.y),z=Math.min(q.y,m.length?m[0].length-1:-1),F=b;K>=F;F++)for(e=y;z>=e;e++)if(v)m[F][e]=0;else{I=V.$1ew({x:F,y:e});var t=I.x-A,G=I.x+A,o=I.y-D,d=I.y+D;E=[t,o,t,d,G,d,G,o],V.$1bw(n,E)&&(m[F][e]=0)}}},Z.prototype.$1dw=function(f,D){var A=this,q=A.$16x,P=(f.x-q.x)/q.gridX,$=(f.y-q.y)/q.gridY;return D!==!1&&(P=Math.round(P),$=Math.round($)),{x:P,y:$}},Z.prototype.$1ew=function(q){var e=this,F=e.$16x;return{x:q.x*F.gridX+F.x,y:q.y*F.gridY+F.y}},Z.prototype.$1fw=function(P){var v=this,R=v.$16x,X=R.xLen,u=R.yLen;if(P.x>=0&&P.x<X&&P.y>=0&&P.y<u)return P;var Z={x:P.x,y:P.y};return Z.x<0?Z.x=0:Z.x>=X&&(Z.x=X-1),Z.y<0?Z.y=0:Z.y>=u&&(Z.y=u-1),Z},Z.prototype.findPath=function(N,d){var O,e,v,w,z=this,y=z.$1dw(N),J=z.$1dw(d);if(v=z.$1fw(y),w=z.$1fw(J),v!==y&&w!==J){var C=z.$16x,u=C.x-C.gridX/2,q=C.y-C.gridY/2,s=u+C.gridX*C.xLen,l=q+C.gridY*C.yLen;if(!(z.$18x(N.x,N.y,d.x,d.y,u,q,s,q)||z.$18x(N.x,N.y,d.x,d.y,s,q,s,l)||z.$18x(N.x,N.y,d.x,d.y,s,l,u,l)||z.$18x(N.x,N.y,d.x,d.y,u,l,u,q)))return[N,d]}v!==y&&(O=!0,y=v),w!==J&&(e=!0,J=w);var f=z.graph.grid[y.x][y.y],F=z.graph.grid[J.x][J.y],Y=AStar.search(z.graph,f,F,{closest:z.$14x.closest,punish:z.$14x.turnPunish});if(!Y||!Y.length)return null;var r=[];r.push(N),O&&r.push(z.$1ew(Y[0]));for(var V=1,$=Y.length;$-1>V;V++)r.push(z.$1ew(Y[V]));if(e)r.push(z.$1ew(Y[$-1])),r.push(d);else{var U=Y[$-1];J.x!==U.x||J.y!==U.y||z.$14x.toGridCenter?r.push(z.$1ew(U)):r.push(d)}return z.$14x.simplify&&(r=z.simplifyPath(r)),z.$20x=r,z.$21x(),r},Z.prototype.debugOn=function(n){this.debugFlag=!0,this.debugSettings=n||{},this.$21x()},Z.prototype.simplifyPath=function(h){var G=h.length;if(2>=G)return h;var l,Y,N=[h[0],h[1]],o=N[0],m=N[1],w=1e-5;for(l=2;G>l;l++)Y=h[l],Math.abs((m.x-o.x)*(Y.y-o.y)-(m.y-o.y)*(Y.x-o.x))<w?m=N[N.length-1]=Y:(o=m,m=Y,N.push(Y));return N},Z.prototype.$21x=function(){var _=this;if(_.$22x(),this.debugFlag){var f=_.grid;if(f){var K,R=_.gv;if(_.debugSettings.$16x!==!1){K=[];for(var i,P,A,o,J,v=[],l=_.$14x.gridSizeX/2,m=_.$14x.gridSizeY/2,I=f.length,t=I?f[0].length:0,c=1;I-1>c;c++)for(var D=1;t-1>D;D++)f[c][D]||(i=_.$1ew({x:c,y:D}),P=i.x-l,A=i.x+l,o=i.y-m,J=i.y+m,K.push({x:P,y:o},{x:P,y:J},{x:A,y:J},{x:A,y:o}),v.push(1,2,2,2,5));var C=new j.Shape;C.s("shape.border.color","rgba(50, 50, 50, 0.2)"),C.s("shape.border.width",1),C.s("shape.background","rgba(200, 50, 100, 0.2)"),C.s("2d.editable",!1),C.s("2d.selectable",!1),C.setPoints(K),C.setSegments(v),_._debugInfo={grid:C},R.dm().add(C)}_.debugSettings.path!==!1&&(K=new j.Shape,_.$20x&&(K.setPoints(_.$20x),K.s("shape.border.color","red"),K.s("shape.border.width",1),K.s("2d.editable",!1),K.s("2d.selectable",!1),K.s("shape.background",null),_._debugInfo||(_._debugInfo={}),_._debugInfo.path=K,R.dm().add(K)))}}},Z.prototype.debugOff=function(){this.debugFlag=!1,this.$22x()},Z.prototype.$22x=function(){var p=this;if(p._debugInfo){var j=p._debugInfo.grid,J=p._debugInfo.path,o=p.gv;j&&o.dm().remove(j),J&&o.dm().remove(J),p._debugInfo=null}}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);